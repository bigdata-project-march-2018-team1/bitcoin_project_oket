version: '2.3'
services:
    price_historical:
        build:
            args:
                - ELASTIC_PASSWORD=$ELASTIC_PASSWORD
                - PYTHON_MODULE=price
            context: app
        command: python3 src/BitcoinPriceIndex_historical.py
        networks:
            - backend
    price_streaming_consumer:
        build:
            args:
                - ELASTIC_PASSWORD=$ELASTIC_PASSWORD
                - PYTHON_MODULE=price
            context: app
        command: spark-submit src/BitcoinPriceIndex_streamingConsumer.py
        networks:
            - backend
            - kafka_net
        depends_on:
            - price_streaming_producer
            - kafka
            - db
    price_streaming_producer:
        build:
            args:
                - ELASTIC_PASSWORD=$ELASTIC_PASSWORD
                - PYTHON_MODULE=price
            context: app
        command: python3 src/BitcoinPriceIndex_streamingProducer.py
        networks:
            - backend
        depends_on:
            - kafka
    price_streaming:
        # start both consumer and producer for streaming
        image: tianon/true
        restart: "no"
        depends_on:
            - price_streaming_consumer
            - price_streaming_producer
