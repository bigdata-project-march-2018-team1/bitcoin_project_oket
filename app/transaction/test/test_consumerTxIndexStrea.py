import sys, os
sys.path.append(os.path.abspath(os.path.dirname(__file__) + '/' + '../src'))
from BitcoinTxIndex_streamingConsumer import filtre_tx

tx_brut_1={'relayed_by': '0.0.0.0', 'out': [{'spent': False, 'n': 0, 'value': 975737, 'tx_index': 339854454, 'script': '76a914b759780aa9fe6118e7a0077f16ab974b9e97226788ac', 'type': 0, 'addr': '1HiTqWp7GMeTtz1YPtxxHvjYoVgQeo7oQ9'}, {'spent': False, 'n': 1, 'value': 228556, 'tx_index': 339854454, 'script': '76a91477dc93b0b57069186cb394ca9ca5377bea33e31c88ac', 'type': 0, 'addr': '1BvmenGpP4Nh6H3LLFmBVRYiYrKhyQSVKW'}, {'spent': False, 'n': 2, 'value': 1043145, 'tx_index': 339854454, 'script': '76a91413368c5cd283a3f5a69a4af7e23a720d254a0a5388ac', 'type': 0, 'addr': '12kbBj8y3EaP8EaZQbCeCfFEXQ8upm52Zo'}, {'spent': False, 'n': 3, 'value': 573434, 'tx_index': 339854454, 'script': '76a91444a93bbd26c951c38445505a462e35ccbfd2693e88ac', 'type': 0, 'addr': '17G3gasxUcxJXisgtXebFMvbFBpPUU8Grb'}, {'spent': False, 'n': 4, 'value': 7531000, 'tx_index': 339854454, 'script': 'a9148160fc0581dd4e6df0aeb48fb48af65cddc178f987', 'type': 0, 'addr': '3DV7GtUFSuBT2HYwswJ6CfZAyPk5rWLYuV'}, {'spent': False, 'n': 5, 'value': 495765, 'tx_index': 339854454, 'script': '76a914e50048b88bc3a07e52cea72dce1152786b7ba71e88ac', 'type': 0, 'addr': '1Msr5fepQEtbF8x9Q41JKenSdxNJ6TRDx3'}, {'spent': False, 'n': 6, 'value': 1048013, 'tx_index': 339854454, 'script': '76a91456bedf14aa32c54713dfc502680c004776d0783888ac', 'type': 0, 'addr': '18ufmUaJShGQNCxfBuPoExA35qCpy8Byqz'}, {'spent': False, 'n': 7, 'value': 12364865, 'tx_index': 339854454, 'script': '76a914dd0d09b4a6799e6da8d12fe32de692a6088fa0f288ac', 'type': 0, 'addr': '1M9oxHWLQyNxiwVLhb2mSKL1EpK9nbHHLj'}, {'spent': False, 'n': 8, 'value': 1346520, 'tx_index': 339854454, 'script': 'a914f6411c4ad33b96ab8e588416d82b2f0ea14a8c7487', 'type': 0, 'addr': '3Q969h6K1sJKkkw1zfMPKBiCkHFC7cLYz4'}, {'spent': False, 'n': 9, 'value': 1017120, 'tx_index': 339854454, 'script': '76a9145553441069b6085764fb79a9989bc4eb8ab8d04b88ac', 'type': 0, 'addr': '18nABimCkrz6poaL49eTa4i9vMNBYUVrPS'}, {'spent': False, 'n': 10, 'value': 66629176, 'tx_index': 339854454, 'script': '76a9142bda852bae2978f0332b2bd7aa54f66b9c2840dd88ac', 'type': 0, 'addr': '14zsqJJEHjonQzgKqr1DeP8u2okAS5iYcx'}], 'hash': '33ebd0e77d0c3c6015babbc181aee9d9c821464341c3dfc82c167dd0e83d40d8', 'vout_sz': 11, 'size': 1023, 'tx_index': 339854454, 'vin_sz': 4, 'lock_time': 516417, 'inputs': [{'prev_out': {'spent': True, 'n': 1, 'value': 70000000, 'tx_index': 339807736, 'script': 'a91442adb7c1c1cf7cbd69c1d097311ee3a566d3219f87', 'type': 0, 'addr': '37madL2m7hZ74VqzjBHVg6D15kZv8GzzLJ'}, 'script': '160014703d02dca10d02a8002ba1136b7a53bcc0a0667f', 'sequence': 4294967294}, {'prev_out': {'spent': True, 'n': 0, 'value': 845041, 'tx_index': 339842575, 'script': 'a914de8fbf19ad626bb160cac5e53cf28f125c6a530787', 'type': 0, 'addr': '3Myp8ozXDLJXr3ABnPSKRYHg9ZD436LrB9'}, 'script': '1600141b4b0d97349a768c106bc29006aa30a55ea1c496', 'sequence': 4294967294}, {'prev_out': {'spent': True, 'n': 2, 'value': 970488, 'tx_index': 339852327, 'script': '76a9146ec35e34248a06f9c8686004d1c3516639a03c0b88ac', 'type': 0, 'addr': '1B6fNWPqkUvcG4XhKwEnnsupgDwgbCGeQZ'}, 'script': '483045022100f374976db48b2cdb634873cb0e7af639adec491548ec0c05dccb75f9521ca85c0220210996afa8fb4a96f1ee4b4c51b06c3bc3077908501a7d273b7f6daf31fe0806012103917a8b1a3c336cf2d6ce436e373d7202aa2d10ce74f7a4f0fd1e88aac5ca052c', 'sequence': 4294967294}, {'prev_out': {'spent': True, 'n': 2, 'value': 21467008, 'tx_index': 339848106, 'script': '76a914c4794bd174cd1b57fcf4be2cb56372a45048c56e88ac', 'type': 0, 'addr': '1JurkQSCQev7gnY83FATFTB8tszsNCvG9A'}, 'script': '483045022100baa3fc13e867cdbec82e3d5d53a0b3e4393feb91ff069a5b3fe7b0a05848518e02200626d73fe84746d77958cd8ff2c84f72f1fce4b19f81e079a566186fbb4eb68c0121036106592cf7706b505ae35dee299f4401b95849e60694b92fa5375c576705f78c', 'sequence': 4294967294}], 'ver': 2, 'time': 1522747110}

tx_brut_2={'relayed_by': '0.0.0.0', 'out': [{'spent': False, 'n': 0, 'value': 8136599, 'tx_index': 339854455, 'script': '76a914385afe81bcd304f900a669b0aac2e72ab16dce2b88ac', 'type': 0, 'addr': '168yr8RqzxvDHWbUSA7TVWeLnbPW8RajDi'}, {'spent': False, 'n': 1, 'value': 5659742, 'tx_index': 339854455, 'script': 'a914921ec56a8389f1bbbd02ea9c858a75d35a1507f887', 'type': 0, 'addr': '3F1dSZvTbenYejBxAFQwJahvDFd96VRcF1'}], 'hash': '7007cb00dc0d59361ca63339abb78f2ac128387f8b79c7abf9ee250c09a2fe75', 'vout_sz': 2, 'size': 666, 'tx_index': 339854455, 'vin_sz': 2, 'lock_time': 0, 'inputs': [{'prev_out': {'spent': True, 'n': 1, 'value': 4587960, 'tx_index': 335181067, 'script': 'a91490d12e9fe24a17efe8741cab76408c9cd91c5c6987', 'type': 0, 'addr': '3EtjpPwWM9d16XNY9oRLU1RTHRr8zg5Mzf'}, 'script': '004730440220373b50fd2d8efe829affd3e50307eb81f07787f26aca5660a0a776f4d2b51bad0220380fc2becc6a838cd06e7be8f7121b4311f62553c477be71884d3127e302012601473044022004882a2bb38ec7514fbf7e17867664ef187dab4765981b6b2843db03014de7bc02202e9e6f37b1bd53fa92eb04a20538d1a14f2513b5066d9e93fdc2d667d8d75399014c695221037a2264035888953bf1e497287d192e909330435e064e0c8ee283c1ef5a20c23b21027bdc73d6d4650935c92f70051d04d0e313dd9620bd969d8e2f0eafa88dc566c02103c57f905ce9c2588b336528d847b6dfe5917e2391b99e9187acd6a8d66201df4a53ae', 'sequence': 4294967295}, {'prev_out': {'spent': True, 'n': 2, 'value': 9218381, 'tx_index': 335408585, 'script': 'a91416806fb9a85cbd7256198cceb1a9d2c1f7734b6687', 'type': 0, 'addr': '33jzegbC5fCGoD5QTAJG1H7X7rNTf2VRRi'}, 'script': '00483045022100dff28ef729146d571e48c015e1e06b2c95fb312438f893c68bd02ee0c5ef885e022049ec947ef3b9279c07570f22e98286c14adcfc531fc787297d7c07e0bf976eec014830450221009fe4b23ccf6bc086e752a2a1564e29cc1f0ddc79baef8c4b72141c26aa8c0b630220354b025c2f6ccbcdeaf041238404f2cba0eab02c0b3b09a32c30fb2c67583fb7014c69522102d60f5a2b8e91da80ec704c397a0d49c943e88ffb15552512941a48910859b4492103b6ca2d2754da7650180b57fe5e484fb59276c83fc5785485eba1f3e251236d2921036fb5a33d10108b7f466beacdaaa20cbe80875c4e5cfc43d65f7d1847fa8b732753ae', 'sequence': 4294967295}], 'ver': 1, 'time': 1522747110}

def testSpecificTx():
    assert filtre_tx(tx_brut_1) == {'value': 93282537, 'time': '2018-04-03T11:18:30', 'tx_index': 339854454} and filtre_tx(tx_brut_2) == {'value': 13806341, 'time': '2018-04-03T11:18:30', 'tx_index': 339854455}
